{% extends 'base.html' %}
{% load static %}


{% block content %}
<div class="split left">
	<h2 align="center">Enter Text or Use Mic</h2>
	<br>
	<form action="" method="post" align="left">
		{% csrf_token %}
		<input type="text" name="sen" class="mytext" id="speechToText" placeholder="">
		<button type="button" name="button" class="mic" onclick="record()"><img src="{% static 'mic3.png' %}"
				height="32px" width="38px" /></button>
		&nbsp&nbsp&nbsp&nbsp
		<input type="submit" name="submit" class="submit">

	</form>
	<br>
	<table cellspacing="20px">
		<tr>
			<td class="td">The text that you entered is:</td>
			<td class="td">{{ text }}</td>
		</tr>
		<tr style="display: none;">
			<td class="td">Key words in sentence:</td>
			<td class="td">
				<ul class="td" id="list" align="center" style="display: none;">
					{% for word in words %}
					<li id="{{ forloop.counter0 }}" style="margin-right: 8px">{{ word }}</li>
					{% endfor %}
				</ul>
			</td>
		</tr>

	</table>
</div>
<div class="split right">
	<h2 align="center">Sign Language Animation</h2>

	<div style="text-align:center"> &nbsp&nbsp
		<button class="submit" onclick="playPause()">Play/Pause</button>
		<!--  LETS USE ONLY PLAY PAUSE BUTTON WITH 720 *420 ,IT FITS THE SCREEN ASHISH

  	<button onclick="makeBig()">Big</button>
  	<button onclick="makeSmall()">Small</button>
  	<button onclick="makeNormal()">Normal</button>-->


		<video id="videoPlayer" width="600" height="350" preload="auto" autoplay muted>
			<source src="" type="video/mp4">
			Your browser does not support HTML5 video.
		</video>
	</div>
</div>


<script>
	//webkitSpeechRecognition api for speech to text conversion
	function record() {
		var recognition = new webkitSpeechRecognition();
		recognition.lang = 'en-IN';

		recognition.onresult = function (event) {
			console.log(event)
			document.getElementById('speechToText').value = event.results[0][0].transcript;
		}
		recognition.start();
	}
	function play() {
		var videoSource = new Array();
		var videos = document.getElementById("list").getElementsByTagName("li");
		var j;
		for (j = 0; j < videos.length; j++) {
			let original = videos[j].innerHTML;
			let modified = original.charAt(0).toUpperCase() + original.slice(1);

			// Then build the video source path
			videoSource[j] = "/static/" + modified + ".mp4";
		}

		var i = 0; // define i
		var videoCount = videoSource.length;

		function videoPlay(videoNum) {
			document.getElementById("list").getElementsByTagName("li")[videoNum].style.color = "#09edc7";
			document.getElementById("list").getElementsByTagName("li")[videoNum].style.fontSize = "xx-large";
			document.getElementById("videoPlayer").setAttribute("src", videoSource[videoNum]);
			document.getElementById("videoPlayer").load();
			document.getElementById("videoPlayer").play();

		}
		document.getElementById('videoPlayer').addEventListener('ended', myHandler, false);
		document.getElementById("list").getElementsByTagName("li")[0].style.color = "#09edc7";
		document.getElementById("list").getElementsByTagName("li")[0].style.fontSize = "xx-large";

		videoPlay(0); // play the video

		function myHandler() {
			document.getElementById("list").getElementsByTagName("li")[i].style.color = "#feda6a";
			document.getElementById("list").getElementsByTagName("li")[i].style.fontSize = "20px";
			i++;
			if (i == videoCount) {
				document.getElementById("videoPlayer").pause();
			}
			else {
				videoPlay(i);
			}
		}
	}
	

	function play() {
  // DB video names exactly as in your list, no extension, case sensitive
  const dbVideos = [
    "0","1","2","3","4","5","6","7","8","9",
    "At","B","Be","Beautiful","Before","Best","Better","Busy","But","Bye",
    "C","Can","Cannot","Change","College","Come","Computer",
    "D","Day","Distance","Do Not","Do","Does Not",
    "E","Eat","Engineer",
    "F","Fight","Finish","From",
    "G","Glitter","Go","God","Gold","Good","Great",
    "H","Hand","Hands","Happy","Hello","Help","Her","Here","His","Home","Homepage","How",
    "I","Invent","It",
    "J",
    "K","Keep",
    "L","Language","Laugh","Learn",
    "M","ME","More","My",
    "N","Name","Next","Not","Now",
    "O","Of","On","Our","Out",
    "P","Pretty",
    "Q",
    "R","Right",
    "S","Sad","Safe","See","Self","Sign","Sing","So","Sound","Stay","Study",
    "T","Talk","Television","Thank You","Thank","That","They","This","Those","Time","To","Type",
    "U","Us",
    "V",
    "W","Walk","Wash","Way","We","Welcome","What","When","Where","Which","Who","Whole","Whose","Why","Will","With","Without","Words","Work","World","Wrong",
    "X",
    "Y","You","Your","Yourself",
    "Z",
    "a","after","again","against","age","all","alone","also","and","ask"
  ];

  // Function to check if video exists in DB (case-sensitive)
  function existsInDB(videoName) {
    return dbVideos.includes(videoName);
  }

  var videoSource = [];
  var videos = document.getElementById("list").getElementsByTagName("li");

  for (let j = 0; j < videos.length; j++) {
    let original = videos[j].innerHTML.trim();

    // Remove file extension if accidentally present
    let name = original.replace(/\.mp4$/i, "");

    if (existsInDB(name)) {
      // Capitalize first char + rest as is for DB matches
      let modified = name.charAt(0).toUpperCase() + name.slice(1);
      videoSource[j] = "/static/" + modified + ".mp4";
    } else {
      // Use original as is (may be lowercase or no capital)
      videoSource[j] = "/static/" + name + ".mp4";
    }
  }

  var i = 0;
  var videoCount = videoSource.length;

  function videoPlay(videoNum) {
    // Reset styles for all li
    for (let k = 0; k < videos.length; k++) {
      videos[k].style.color = "#feda6a";
      videos[k].style.fontSize = "20px";
    }
    // Highlight current
    videos[videoNum].style.color = "#09edc7";
    videos[videoNum].style.fontSize = "xx-large";

    let videoPlayer = document.getElementById("videoPlayer");
    videoPlayer.setAttribute("src", videoSource[videoNum]);
    videoPlayer.load();
    videoPlayer.play();
  }

  function myHandler() {
    i++;
    if (i == videoCount) {
      document.getElementById("videoPlayer").pause();
      // Optionally reset styling of last item
      for (let k = 0; k < videos.length; k++) {
        videos[k].style.color = "#feda6a";
        videos[k].style.fontSize = "20px";
      }
      i = 0; // reset if you want to loop or just stop here
    } else {
      videoPlay(i);
    }
  }

  // Initial highlight and play
  videoPlay(0);

  // Listen to video ended event to move to next
  document.getElementById('videoPlayer').addEventListener('ended', myHandler, false);
}


	/* LETS USE ONLY PLAY PAUSE BUTTON WITH 720 *420 ,IT FITS THE SCREEN
	function makeBig() {
		document.getElementById("videoPlayer").width = 560;
		document.getElementById("videoPlayer").height = 360;
	}

	function makeSmall() {
		document.getElementById("videoPlayer").width = 320;
		document.getElementById("videoPlayer").height = 180;
	}

	function makeNormal() {
		document.getElementById("videoPlayer").width = 420;
		document.getElementById("videoPlayer").height =280;
	}*/
	function playPause() {
		if (document.getElementById("videoPlayer").paused) {
			play();
		}
		else {
			document.getElementById("videoPlayer").pause();
		}
	}

</script>


{% endblock %}